!function(){"use strict";function e(e,t,i){return{restrict:"EA",replace:!0,scope:{videoId:"=?",playlist:"=?",ratio:"=?",loop:"=?",mute:"=?",start:"=?",end:"=?",contentZIndex:"=?",allowClickEvents:"=?",mobileImage:"=?",playerCallback:"&?"},transclude:!0,template:"<div><div></div><div ng-transclude></div></div>",link:function(n,o){function r(e,t){var i;return function(){var n=this,o=arguments,r=function(){i=null,e.apply(n,o)};clearTimeout(i),i=setTimeout(r,t)}}function a(){var e=window.navigator.userAgent,t=e.indexOf("MSIE "),i=e.indexOf("Trident/"),n=e.indexOf("Edge/");if(t>0)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(i>0){var o=e.indexOf("rv:");return parseInt(e.substring(o+3,e.indexOf(".",o)),10)}return n>0?parseInt(e.substring(n+5,e.indexOf(".",n)),10):!1}function l(e,t){var i=["top","right","bottom","left"],n=function(i,n){return i[n]=parseInt(t.call(w,e+"-"+n),10),i};return i.reduce(n,{})}function d(e,t){function i(){var e,i=Array.prototype.slice.call(arguments),n=0,o=function(t,i){return e[i]?t+e[i]:t};for(var r in t)t.hasOwnProperty(r)&&(e=t[r],n+=i.reduce(o,0));return n}return{width:e.width+i("left","right"),height:a()&&a()<12?e.height:e.height+i("top","bottom")}}function u(){var e=o.children().eq(1),t=!!e.children().length,i=Array.prototype.slice.call(o.parent().children());if(o.parent().css({position:"relative",overflow:"hidden"}),!t){o.css({position:"absolute",left:"0",top:"0"});var r=i.indexOf(o[0]);r>-1&&i.splice(r,1),e=angular.element(i)}e.css({position:"relative",zIndex:n.contentZIndex||99})}function s(){w=e.getComputedStyle(o.parent()[0]);var t=["width","height"],i=["border","margin"];return a()&&a()<12&&i.push("padding"),t=t.reduce(function(e,t){return e[t]=parseInt(w.getPropertyValue(t),10),e},{}),i=i.reduce(function(e,t){return e[t]=l(t,w.getPropertyValue),e},{}),d(t,i)}function c(){var e=parseInt(P.width/n.ratio,10),t=parseInt(P.height*n.ratio,10),i=P.height<e;return{width:i?P.width:t,height:i?e:P.height}}function p(){u(),P=s(),T=c()}function f(){var e={zIndex:1,position:"absolute",width:T.width+"px",height:T.height+"px",left:parseInt((P.width-T.width)/2,10)+"px",top:parseInt((P.height-T.height)/2,10)+"px"};n.allowClickEvents||(e.pointerEvents="none"),B.css(e)}function h(e){e=e||n,x.seekTo(e.start||0)}function y(e){var t,i;e=e||n,t=e.end?e.end-(e.start||0):n.start?x.getDuration()-e.start:x.getDuration(),i=1e3*t,console.log("duration",i),E=setTimeout(function(){n.playlist?x.nextVideo():h(e)},i)}function v(){var e=n.playlist[x.getPlaylistIndex()];y(e)}function g(){M&&i(function(){M({player:x})}),n.playlist&&(x.loadPlaylist(A),n.loop&&x.setLoop(!0)),n.mute&&!x.isMuted()?x.mute():x.isMuted()&&x.unMute(),h(),n.$on("$destroy",function(){E&&clearTimeout(E),angular.element(e).off("resize",S),x.destroy()})}function m(e){if(e.data===YT.PlayerState.PLAYING&&(B.css("display","block"),!n.playlist&&n.loop&&y(),n.playlist&&n.loop&&v()),e.data===YT.PlayerState.UNSTARTED&&n.playlist){var t=n.playlist[x.getPlaylistIndex()],i=void 0===t.mute?n.mute:t.mute;B.css("display","none"),h(t),i||i&&n.mute?(console.log("mute"),x.isMuted()||x.mute()):i&&n.mute||(console.log("unmute"),x.isMuted()&&x.unMute())}}function I(){p();var e={autoplay:1,controls:0,iv_load_policy:3,cc_load_policy:0,modestbranding:1,playsinline:1,rel:0,showinfo:0,playlist:n.videoId};x=new YT.Player(b,{width:T.width,height:T.height,videoId:n.videoId,playerVars:e,events:{onReady:g,onStateChange:m}}),B=o.children().eq(0),B.css("display","none"),f()}var w,b,x,P,T,A,E,O=document.querySelector('script[src="//www.youtube.com/iframe_api"]'),B=o.children().eq(0),M=n.playerCallback;if(b="player"+Array.prototype.slice.call(document.querySelectorAll("div[video-id]")).indexOf(o[0]),B.attr("id",b),n.ratio=n.ratio||16/9,n.loop=void 0===n.loop?!0:n.loop,n.mute=void 0===n.mute?!0:n.mute,!n.videoId&&!n.playlist)throw new Error("Either video-id or playlist must be defined.");if(n.videoId&&n.playlist)throw new Error("Both video-id and playlist cannot be defined, please choose one or the other.");n.playlist&&(A=n.playlist.map(function(e){return e.videoId}));var S=r(function(){p(),f()},300);if(!/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)){if(!e.youTubeIframeAPIReady){var k=t.defer();e.youTubeIframeAPIReady=k.promise,e.onYouTubeIframeAPIReady=function(){k.resolve()}}if(!O){var $=document.createElement("script");$.src="//www.youtube.com/iframe_api";var C=document.getElementsByTagName("script")[0];C.parentNode.insertBefore($,C)}e.youTubeIframeAPIReady.then(I),angular.element(e).on("resize",S)}n.$watch("videoId",function(e,t){e&&t&&e!==t&&(clearTimeout(E),B.css("display","none"),x.loadVideoById(e))}),n.$watchCollection("playlist",function(e,t){e&&t&&e!==t&&(clearTimeout(E),A=e.map(function(e){return e.videoId}),x.loadPlaylist(A),n.loop&&x.setLoop(!0))})}}}angular.module("angularVideoBg",[]),angular.module("angularVideoBg").directive("videoBg",e),e.$inject=["$window","$q","$timeout"]}();
